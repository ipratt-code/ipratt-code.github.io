/*
*	NodTalk.js: a way to communicate through Nod WebSockets
*	Made by github user CompactCow
*	On January 22 2021
*/

var sendJson=function(){console.log("not started")};function launchApp(){var name=document.getElementById("name").value;if(name==false){name="Unnamed User"}var channel=document.getElementById("channel").value;if(channel==false){channel="main"}$(".channel-indicator").html("#"+channel);$(".name-indicator").html(name);connect(name,channel);$(".homepage").removeClass('visible');$(".homepage").addClass('hidden');$(".client").removeClass('hidden');$(".client").addClass('visible')}$(document).keyup(function(event){if($(".name").is(":focus")&&event.key=="Enter"){launchApp()}});function connect(name,channel){var ws=new WebSocket('wss://j24amtdvi4.execute-api.us-east-1.amazonaws.com/prod');sendJson=function sendJson(msg){ws.send(JSON.stringify(msg))};ws.onopen=function(){sendJson({route:"join",data:{id:channel,team:"lt"}});const tryConnect=()=>{console.log("Keeping Nod alive...");sendJson({route:"ping"})};setInterval(tryConnect,54E4)};ws.onmessage=function(event){console.log(event.data);var obj=JSON.parse(event.data);var user=clean(obj.message.username);var msg=clean(obj.message.emoji);$(".messages").append(user+": "+msg+"<br>");$(".messages").scrollTop($(".messages").scrollHeight)};ws.onclose=function(e){console.log('Socket is closed. Reconnect will be attempted in 1 second.',e.reason);setTimeout(function(){connect()},1000)};ws.onerror=function(err){console.error('Socket encountered error: ',err.message,'Closing socket');ws.close()}}function sendMessage(){if(document.getElementById("message-box").value.length==0){return false}sendJson({action:"MESSAGE",message:{id:document.getElementById("channel").value,emoji:document.getElementById("message-box").value,username:document.getElementById("name").value,img:"",tone:""}});$(".messages").append("You: "+document.getElementById("message-box").value+"<br>");$(".messages").scrollTop($(".messages").scrollHeight);document.getElementById("message-box").value=""};$(document).keyup(function(event){if($(".message-box").is(":focus")&&event.key=="Enter"){sendMessage()}});function clean(unsafe){return unsafe.replace(/[<>&'"]/g,function(c){switch(c){case '<':return '&lt;';case '>':return '&gt;';case '&':return '&amp;';case '\'':return '&apos;';case '"':return '&quot;';case ':':return '&#58;';case ';':return '&#59;';case '{':return '&#123;';case '}':return '&#125;';case ',':return '&#44;'}})}