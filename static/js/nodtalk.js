/*
*	NodTalk.js: a way to communicate through Nod WebSockets
*	Made by github user CompactCow
*	On January 22 2021
*/

var sendJson=function(){console.log("not started")};function launchApp(){var e=document.getElementById("name").value;0==e&&(e="Unnamed User");var n=document.getElementById("channel").value;$(".channel-indicator").html("#"+n),$(".name-indicator").html(e),connect(e,n),$(".homepage").removeClass("visible"),$(".homepage").addClass("hidden"),$(".client").removeClass("hidden"),$(".client").addClass("visible")}function connect(e,n){var s=new WebSocket("wss://j24amtdvi4.execute-api.us-east-1.amazonaws.com/prod");sendJson=function(e){s.send(JSON.stringify(e))},s.onopen=function(){sendJson({route:"join",data:{id:n,team:"lt"}});setInterval(()=>{console.log("Keeping Nod alive..."),sendJson({route:"ping"})},54e4)},s.onmessage=function(e){console.log(e.data);var n=JSON.parse(e.data),s=clean(n.message.username),o=clean(n.message.emoji);$(".messages").append(s+": "+o+"<br>"),$(".messages").scrollTop($(".messages").scrollHeight)},s.onclose=function(e){console.log("Socket is closed. Reconnect will be attempted in 1 second.",e.reason),setTimeout(function(){connect()},1e3)},s.onerror=function(e){console.error("Socket encountered error: ",e.message,"Closing socket"),s.close()}}function sendMessage(){sendJson({action:"MESSAGE",message:{id:document.getElementById("channel").value,emoji:document.getElementById("message-box").value,username:document.getElementById("name").value,img:"",tone:""}}),$(".messages").append("You: "+document.getElementById("message-box").value+"<br>"),$(".messages").scrollTop($(".messages").scrollHeight),document.getElementById("message-box").value=""}function clean(e){return e.replace(/[<>&'"]/g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})}$(".name").on("keyup",function(e){"Enter"!==e.key&&13!==e.keyCode||launchApp()}),$(".message-box").on("keyup",function(e){"Enter"!==e.key&&13!==e.keyCode||sendMessage()});